<script type="text/javascript">
  $(function() {
    var param = util.getWindowParam();
    // 类别下拉框
    $('#zdyp_ypbmnumber').combogrid({
      panelWidth : 500,
      idField : 'kc_ypbmnumber',
      textField : 'kc_ypbmnumber',
      mode : 'local',
      // 				mode:'mode', 
      filter:function(q,row){
        return row["kc_ypname"].indexOf(q)>=0&&row["kc_shuliang"]>0;
      },
      fitColumns : true,
      url : global_param.context_name + "/select/getByCode/getyaopinkucun",
      columns : [ [ {
        field : 'kc_ypbmnumber',
        title : '药品编码',
        width : 100
      }, {
        field : 'kc_ypname',
        title : '药品名字',
        width : 100
      }, {
        field : 'kc_shuliang',
        title : '库存数量',
        width : 50
      }, {
        field : 'useMethod',
        title : '使用方式',
        width : 50
      }, {
        field : 'useAmount',
        title : '剂量',
        width : 50
      }, {
        field : 'useFrequence',
        title : '使用频率',
        width : 50
      }, {
        field : 'kc_shengchanshang',
        title : '生产商',
        width : 100
      } ] ],
      onSelect : function(index, row) {
        $("#zdyp_ypid").val(row.id);
        $("#zdyp_ypbcxsjiage").val(row.zdyp_ypbcxsjiage);
        $("#zdyp_ypcbjiage").val(row.zdyp_ypcbjiage);
        $("#zdyp_ypbmid").val(row.kc_ypbmid);
        $("#zdyp_ypname").val(row.kc_ypname);
        $("#kc_shuliang").val(row.kc_shuliang);
        $("#zdyp_ypdanwei").val(row.kc_danwei);
        $("#zdyp_ypleibie").val(row.kc_ypleibie);
        $("#zdyp_ypshengchanshang").val(row.kc_shengchanshang);
        $("#zdyp_ypbcxsjiage").val(row.kc_lsjiage);
        $("#zdyp_yplsjiage").val(row.kc_lsjiage);
        $("#zdyp_ypcbjiage").val(row.kc_cbjiage);
        $("#zdyp_ypzdjiage").val(row.kc_zdjiage);
        $("#useMethod").combobox("select", row.useMethod);
        $("#useAmount").combobox("select", row.useAmount);
        $("#useFrequence").combobox("select", row.useFrequence);
      }
    });
    var param = util.getWindowParam();
    // 得到url中id值
    if (param.id) {
      var data = util.ajax(global_param.context_name + '/yaoju/ruku/getById', {
        "id" : param.id
      });
      $("#_form").form("load", data);
    }
    // 		var keshengouliang = util.ajax(global_param.context_name
    // 				+ '/keshi/keshiweihu/keshengouliang');
    // 		$("#keshengouliang").val(doubleNumber(keshengouliang,6));

  });
  function submitForm() {

    var useAmount = $('#useAmount').combobox("getText");
    var useMethod = $('#useMethod').combobox("getText");
    var useFrequence = $('#useFrequence').combobox("getText");

    if (useAmount != "") {
      $.a("postJsonA", global_param.context_name + "/fn/createDictUseAmount", {
        text : useAmount
      }, function() {
      }, function() {
      });
    }
    if (useMethod != "") {
      $.a("postJsonA", global_param.context_name + "/fn/createDictUseMethod", {
        text : useMethod
      }, function() {
      }, function() {
      });
    }
    if (useFrequence != "") {
      $.a("postJsonA",
          global_param.context_name + "/fn/createDictUseFrequence", {
            text : useFrequence
          }, function() {
          }, function() {
          });
    }
    var item = {
        ypid:$("#zdyp_ypid").val(),
        ypbmid:$("#zdyp_ypbmid").val(),
        zdyp_ypbmnumber:$("#zdyp_ypbmnumber").combo("getText"),
        zdyp_ypname:$("#zdyp_ypname").val(),
        zdyp_ypnamekc_shuliang:$("#zdyp_ypnamekc_shuliang").val(),
        zdyp_ypshuliang:$("#zdyp_ypshuliang").val(),
        zdyp_ypshuliangzdyp_ypdanwei:$("#zdyp_ypshuliangzdyp_ypdanwei").val(),
        zdyp_ypleibie:$("#zdyp_ypleibie").val(),
        zdyp_ypdanwei:$("#zdyp_ypdanwei").val(),
        zdyp_ypshengchanshang:$("#zdyp_ypshengchanshang").val(),
        useMethod:$("#useMethod").combo("getText"),
        useAmount:$("#useAmount").combo("getText"),
        useFrequence:$("#useFrequence").combo("getText"),
        zdyp_ypbcxsjiage:$("#zdyp_ypbcxsjiage").val(),
        zdyp_ypcbjiage:$("#zdyp_ypcbjiage").val()
    };
    
    $("body div#main").trigger("addPrescriptionItem", item);
    
    util.closeWindow('editWindow1');

  }
  function initJinE() {
    var jiage = $("#zdyp_ypbcxsjiage").val();
    var shuliang = $("#zdyp_ypshuliang").val();
    if (jiage == "") {
      return;
    }
    if (shuliang == "") {
      return;
    }
    var zdyp_danxiangjine = parseFloat(jiage) * parseFloat(shuliang);
    $("#zdyp_danxiangjine").val(zdyp_danxiangjine);

  }
</script>
<div class="easyui-layout" fit="true">
	<div region="center" border="false" class="Dialog-Bg">
		<div class="Dialog-formDiv clearfix">
			<form id="_form" action="/YLManager/kaiyao/kaiyao/save" method="post">
				<input id="id" name="id" type="hidden" /> <input id="zdyp_ghnumber"
					name="zdyp_ghnumber" type="hidden" /> <input id="zdyp_ghid"
					name="zdyp_ghid" type="hidden" /> <input id="zdyp_zdid"
					name="zdyp_zdid" type="hidden" />
				<div class="float-l clearboth">
					<div class="Dialog-form-title2">
						<label for="kc_ypbmnumber" class="field">药品编码：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="zdyp_ypbmnumber" name="zdyp_ypbmnumber" type="text"
							style="width: 158px;" class="easyui-validatebox"
							data-options="required:true" /> <input id="zdyp_ypid"
							name="zdyp_ypid" type="hidden" /> <input id="zdyp_ypbmid"
							name="zdyp_ypbmid" type="hidden" />
							<input id="zdyp_ypbcxsjiage" type="hidden"/>
							<input id="zdyp_ypcbjiage" type="hidden"/>
					</div>
				</div>
				<div class="float-l">
					<div class="Dialog-form-title2">
						<label for="zdyp_ypname" class="field">药品名称：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="zdyp_ypname" name="zdyp_ypname" type="text"
							class="easyui-validatebox" data-options="required:true"
							readonly="readonly" />
					</div>
				</div>
				<div class="float-l">
					<div class="Dialog-form-title2">
						<label for="kc_shuliang" class="field">库存数量：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="kc_shuliang" name="kc_shuliang" type="text"
							class="easyui-validatebox" data-options="required:true" />
					</div>
				</div>
				<div class="float-l">
					<div class="Dialog-form-title2">
						<label for="zdyp_ypshuliang" class="field">销售数量：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="zdyp_ypshuliang" name="zdyp_ypshuliang" type="text"
							class="easyui-validatebox" onblur="initJinE();"
							data-options="required:true" />
					</div>
				</div>
				<div class="float-l">
					<div class="Dialog-form-title2">
						<label for="zdyp_ypdanwei" class="field">药品单位：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="zdyp_ypdanwei" name="zdyp_ypdanwei" type="text"
							class="easyui-validatebox" data-options="required:true"
							readonly="readonly" />
					</div>
				</div>


				<div class="float-l clearboth2">
					<div class="Dialog-form-title2">
						<label for="zdyp_ypleibie" class="field">药品类别：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="zdyp_ypleibie" name="zdyp_ypleibie" type="text"
							style="width: 152px" readonly="readonly" />
					</div>
				</div>
				<div class="float-l">
					<div class="Dialog-form-title2">
						<label for="zdyp_ypshengchanshang" class="field">生产商：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="zdyp_ypshengchanshang" name="zdyp_ypshengchanshang"
							type="text" class="easyui-validatebox"
							data-options="required:true" readonly="readonly" />
					</div>
				</div>
				<div class="float-l clearboth2">
					<div class="Dialog-form-title2">
						<label for="useMethod" class="field">使用方式：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="useMethod" name="useMethod" class="easyui-combobox"
							data-options="required:false,valueField:'text',textField:'text',url:'/YLManager/fn/findDictUseMethod'"
							style="width: 152px" />
					</div>
				</div>
				<div class="float-l clearboth2">
					<div class="Dialog-form-title2">
						<label for="useAmount" class="field">用量：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="useAmount" name="useAmount" class="easyui-combobox"
							data-options="required:false,valueField:'text',textField:'text',url:'/YLManager/fn/findDictUseAmount'"
							style="width: 152px" />
					</div>
				</div>
				<div class="float-l clearboth2">
					<div class="Dialog-form-title2">
						<label for="useFrequence" class="field">使用次数：</label>
					</div>
					<div class="Dialog-form-item">
						<input id="useFrequence" name="useFrequence"
							class="easyui-combobox"
							data-options="required:false,valueField:'text',textField:'text',url:'/YLManager/fn/findDictUseFrequence'"
							style="width: 152px" />
					</div>
				</div>
			</form>
		</div>
	</div>
	<div data-options="region:'south',border:false" class="Dialog-footer">
		<input id="" class="btn-save"
			onmouseover="this.className='btn-save-over'"
			onmouseout="this.className='btn-save'"
			onmousedown="this.className='btn-save-down'" type="button"
			onclick="submitForm();" /> <input id="" class="btn-cancel"
			onmouseover="this.className='btn-cancel-over'"
			onmouseout="this.className='btn-cancel'"
			onmousedown="this.className='btn-cancel-down'" type="button"
			onclick="util.closeWindow('editWindow1');" />
	</div>
</div>